--- 
title: "Golden Cross"
author: "Vipul H Harihar, Zhaoyu Wu, Zhirui Yang"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```

# Introduction

EDAV Final Project Assignment: Golden Cross

## Final Project Group: Vipul Harihar, Zhaoyu Wu and Zhirui Yang Introduction

The world is changing and adapting to cope with the major technological advancements and changes but we never realized that ‘Data’, the term that used to describe statistics, would be so huge by the first quarter of the 21st Century. Superficially from a bird's eye view we may say small governments, corporations, and individuals focus more on human impact to the environment while international financial markets have responded with innovative products to help manage climate risk and invest in mitigating technologies. Big firms play a key function in markets, committing capital to bridge timing differences between buyers and sellers. With the financial industry debating underlying market structure tenets such as tick sizes there has been renewed focus on different types of market making activity.

## Why ‘Stocks’ ? What is ‘Stock Exchange’? 
A stock or the term share is usually used in representing a company's equity. We may understand it as a financial instrument that assists in showing ownership in a corporation or a company and it represents a proportionate claim on its assets (what it owns) and earnings (what it generates in profits). When we think of the term share stock exchanges, it is the secondary market, where existing owners of shares can transact these shares of their equities with potential buyers. It is important to comprehend that the corporations on stock markets do not buy and sell their own shares on a regular basis (companies may engage in stock buybacks or issue new shares, but these are not day-to-day operations and often occur outside of the framework of an exchange). So we may sum it as whenever you buy a share of stock on the stock market, you are not buying the stock directly from the company, you are buying it from another existing shareholder. Likewise, when you want to sell the shares you own , they are not sold to the company—rather you sell them to some other investors.

Project Problem Statement There are numerous people in the market who want to invest in the stock market are way too afraid to put their life’s savings at stake. Many people pour their life savings and dump their 401K (contribution retirement plan) into the stock and option market. They perform various strategies and financial maneuvers, hoping to gain massive profits but generally end up losing most of their investments or still having underperformance in the general market. Thus, our team started thinking if there is an investing strategy that can consistently beat the index fund return.

EDAV Final Project Assignment

A recently published article by Barclays on Impact of Retail Options Trading (https://www.docdroid.net/5gM68EW/barclays-us-equity-derivatives-strategy-impact-of-retailoptions-trading-pdf) raised an interesting theory: the market participation of the retail traders (the ordinary traders like us) creates a systematic dislocation between the implied volatility and the actual price volatility of stocks. The article also claims that there are two possible ways to generate profits from this dislocation: • Hedged straddle • Call spreads

##  What Does a Golden Cross Tell You?

There are three stages to a golden cross. In the second stage, the shorter moving average forms a crossover up through the larger moving average to trigger a breakout and confirmation of trend reversal. The moving averages act as support levels on pullbacks until they crossover back down at which point a death cross may form. The death cross is the opposite of the golden cross as the shorter moving average forms a crossover down through the longer moving average.

With a bellwether index, the motto «A rising tide lifts all boats» applies when a golden cross forms as the buying resonates throughout the index components and sectors. Day traders commonly use smaller time periods like the 5-period and 15-period moving averages to trade intra-day golden cross breakouts. The larger the chart time frame, the stronger and lasting the golden cross breakout tends to be.

The Difference Between a Golden Cross and a Death Cross

A golden cross indicates a long-term bull market going forward, while a death cross signals a long-term bear market. The golden cross occurs when a short-term moving average crosses over a major long-term moving average to the upside and is interpreted by analysts and traders as signaling a definitive upward turn in a market.

Limitations of Using the Golden Cross

Many times, an observed golden cross produces a false signal. Despite its apparent predictive power in forecasting prior large bull markets, golden crosses also do regularly fail to manifest. Therefore, a golden cross should always be confirmed with other signals and indicators before putting on a trade.

What Does a Golden Cross Indicate?

A golden cross suggests a long-term bull market going forward.

Are Golden Crosses Reliable Indicators?

Traders often use a golden cross as confirmation of a trend or signal in combination with other indicators.

How are we going to Proceed?

Data Sources- data has to be historical
Data Collection from valid resources
Using Accurate metrics to define our problem questions
Plotting exploratory data analytics visuals, including CAGR (componded annual growth rate) and bootstrap simulation
Using d3.js / plotly.js for better understanding and deeper insights (if time permits)
Summary: What are we going to do in the primary phase of the project? 
• A financial study on the stock market published last year raised an intriguing theory 
• Golden Cross and it’s capabilities EDAV Final Project Assignment 4 
• Data Cleaning and Exploration
• Report writing and visuals finalization 
• Study on the paper published by Barclay Equity Research: Impact of Retail Options Trading

## Current Questions under study: We are primarily focusing on these questions mentioned below:

Data Investigation and checking if ‘olden Cross’ exists by analyzing the trends in the past 10 years data?
Examination from a pure data perspective, using the visualization techniques to demonstrate the difference between the implied volatility and historical volatility.
What are some of the factors that influence the magnitude of this dislocation?
Do spread calls and hedged straddles effectively monetize this dislocation and consistently beat the general market return? (Bootstrap stimulation)
Calculation of the golden cross Data Source and its availability: We have a variety of data sources available to us. But as we are aware of this data being so valuable we couldn’t get it for free thus on digging up deep, we found the Yahoo Finance Website. (The Yahoo! Finance is a media property that is part of the Yahoo! network. It provides financial news, data and commentary including stock quotes, press releases, financial reports, and original content. It also offers some online tools for personal finance management.) We are going to work and cover the industrial giants in the stock market and provide and collate actual and relevant data sources from the Yahoo finance website, itself. 

Actual price data: https://finance.yahoo.com/ Stock lists: (Index ETF: S&P 500) • Alphabet Inc. :https://finance.yahoo.com/quote/GOOG?p=GOOG&.tsrc=fin-srch • Apple: https://finance.yahoo.com/quote/AAPL?p=AAPL&.tsrc=fin-srch • Tesla: https://finance.yahoo.com/quote/TSLA?p=TSLA&.tsrc=fin-srch • Walmart: https://finance.yahoo.com/quote/WMT?p=WMT&.tsrc=fin-srch • Wells Fargo & Company: https://finance.yahoo.com/quote/WFC?p=WFC&.tsrc=fin-srch • Paypal Holdings & Inc: https://finance.yahoo.com/quote/PYPL?p=PYPL&.tsrc=fin-srch • JPM & Chase: https://finance.yahoo.com/quote/JPM?p=JPM&.tsrc=fin-srch • McDonald: https://finance.yahoo.com/quote/MCD?p=MCD&.tsrc=fin-srch • PepsiCo: https://finance.yahoo.com/quote/PEP?p=PEP&.tsrc=fin-srch

EDAV Final Project Assignment Footnotes Sample Data Set (Just for introductory purpose) Open: The starting period of trading on a securities exchange or organized over-the-counter market High: The high is the highest price at which a stock traded during a period. Low: The low is the lowest price of the period. Close: The close is a reference to the end of a trading session in the financial markets when the markets close for the day. Adj Close: The adjusted closing price amends a stock's closing price to reflect that stock's value after accounting for any corporate actions. Volume: Is the measure of how much of a given financial asset has traded in a period of time. Resources: https://www.docdroid.net/5gM68EW/barclays-us-equity-derivatives-strategy-impact-of-retailoptions-trading-pdf https://www.investopedia.com/articles/investing/082614/how-stock-market-works.asp https://www.investopedia.com/terms/i/iv.asp

<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data sources


<!--chapter:end:02-data.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data transformation

Please click this link to see our work. Thank you :)
https://github.com/Alex2Yang97/GoldenCross_5702final

<!--chapter:end:03-cleaning.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Missing values

```{r}
knitr::opts_chunk$set(fig.width=8, fig.height=12)
```

```{r}
library(fivethirtyeight)
library(tidyverse)
library(patchwork)
library(plotly)
```

<<<<<<< HEAD

=======
As what we mentioned in Final Project Data Check, we are working on the financial data, like the open and close prices of stocks. All these data are publicly available, so there is no missing values. Although we can regard non-trading days as missing value, in fact these missing values don’t matter at all because all public marketing behaviors stop at these days. Moreover, we are calculating some technical indicators, like moving average with different time span, so there will be some missing values (Null value) at the beginning of the data because there is not enough data to calculate the sliding window. However, in our trading strategies, we need to drop all Null values at the beginning of our backtesting intervals in order to get accurate technical indicators. Therefore, in this way we don’t have any missing value in our raw data and processed data. We will use "backup" data for this missing value chapter. In this chapter, we will use avengers Dataset.



## Basics of avengers Dataset

The first step is to load data and check the basic information about the data. We should know the dimension of the dataset and the meaning of each column.


```{r}
head(avengers)
```

```{r}
colnames(avengers)
```

```{r}
dim(avengers)
```


## Check Missing Values

We will check the missing values in the whole data.

```{r}
colSums(is.na(avengers)) %>%
  sort(decreasing = TRUE)

rowSums(is.na(avengers)) %>%
  sort(decreasing = TRUE)
```

We can see that there are lots of missing values in the data. To better understand there distribution, we will transfer the missing value into a binary variable "missing", then plot a heatmap to show the missing value.

```{r}
avengers_nan <- avengers %>% 
    rownames_to_column("id") %>% 
    gather(key, value, -id) %>% 
    mutate(missing = ifelse(is.na(value), "yes", "no")) 
avengers_nan
```


```{r fig.width=5, fig.height=20}
ggplot(avengers_nan, aes(x = key, y = fct_rev(id), fill = missing)) +
  geom_tile(color = "white") + 
  ggtitle("Missing value in data") +
  scale_fill_viridis_d() + # discrete scale
  theme_bw() +
  theme(legend.position = 'None', axis.text.x = element_text(angle = 60, hjust = 1))
```

We can find that most of missing values appeared in the "death" or "return" columns. These columns represent the number of deaths and returns of characters. In Marvels, it is very common for some superheroes or super devils to resurge many times. Therefore, we can estimate that these missing values may represent the importance or the power of characters. For example, some important or powerful characters may seldom die or could resurge every time they die.

Therefore, we select all the "death" columns and plot the heatmap.

```{r}
death <- avengers[, c('name_alias', 'death1', 'death2', 'death3', 'death4', 'death5')]
death_nan <- death %>% 
    gather(key, value, -name_alias) %>% 
    mutate(missing = ifelse(is.na(value), "yes", "no")) 
head(death_nan)
```


```{r fig.width=5, fig.height=20}
ggplot(death_nan, aes(x = key, y = fct_rev(name_alias), fill = missing)) +
  geom_tile(color = "white") + 
  ggtitle("Missing value in death") +
  scale_fill_viridis_d() +
  theme_bw() +
  theme(legend.position = 'None', axis.text.x = element_text(angle = 60, hjust = 1))
```

All the rows (characters) have "True" value in "death1" columns. It means that every character has at least one death, which may represent all the superpowers were born of fire. This is actually how the Marvels start a superhero story. Superhero typically got superpowers by some disasters or accidents at the beginning of the story.

Then we can check two famous superheroes, Iron man and Jocasta.

```{r}
death %>% filter(name_alias=='Anthony Edward "Tony" Stark')
```

```{r}
death %>% filter(name_alias=='Jocasta')
```

We can see that Tony only died once. In Marvels, Iron man is one of the most power superhero, and he fight many times successfully.\n He only died in the fighting with Thanos. He is also the most important in Marvels movies. And Jocasta is a "non-living" construct.\n She did not has strong power, but she could resurge because she required no food, water, or oxygen to survive and she was also \n immune to poisons and diseases. She is also one of the most important character of Marvels cartoons. It fits our initial hypothesis\n for the number of daeth.\n

Then we can also show the heatmap of "return" columns.\n

```{r}
return <- avengers[, c('name_alias', 'return1', 'return2', 'return3', 'return4', 'return5')]
return_nan <- return %>% 
    gather(key, value, -name_alias) %>% 
    mutate(missing = ifelse(is.na(value), "yes", "no")) 
head(return_nan)
```

```{r fig.width=5, fig.height=20}
ggplot(return_nan, aes(x = key, y = fct_rev(name_alias), fill = missing)) +
  geom_tile(color = "white") + 
  ggtitle("mtcars with NAs added") +
  scale_fill_viridis_d() +
  theme_bw() +
  theme(legend.position = 'None', axis.text.x = element_text(angle = 60, hjust = 1))
```

## Check missing values by year

We will check missing values by year. We can find if there is a pattern of the number of death or return.

There are the years when the Marvels had a new character. We can see that there are some big gaps between certain years. From these years we can know the productive periods of Marvels.

```{r}
unique(avengers$year) %>%
  sort(decreasing = FALSE)
```

We gather all "death" columns into one "death" columns.

```{r}
death <- avengers[, c('year', 'death1', 'death2', 'death3', 'death4', 'death5')]
death_nan <- death %>% 
    gather(key, death, -year)
death_nan <- subset(death_nan, select = -c(key))
head(death_nan)
```

```{r}
# https://stackoverflow.com/questions/26017640/using-dplyr-summarise-each-with-is-na
death_perc <- death_nan %>% 
  group_by(year) %>%
  summarise_each(funs(sum(is.na(.)) / length(.)))
```

```{r}
characters_num <- aggregate(death ~ year, data = death_nan, FUN = length)
characters_num
```

```{r}
fig <- plot_ly(
  death_perc,
  x = ~year,
  y = ~death,
  type = "bar"
)
fig <- fig %>% layout(title = "The persentage of Missing values in Death",
         xaxis = list(title = "The persentage of Missing values"),
         yaxis = list(title = "Year"))
fig
```

```{r}
fig <- plot_ly(
  characters_num,
  x = ~year,
  y = ~death,
  type = "bar"
)

fig <- fig %>% layout(title = "The number of Missing values in Death",
         xaxis = list(title = "The number of Missing values"),
         yaxis = list(title = "Year"))

fig
```

We count the number of characters and the percentage of missing values for each year. We can see that although the number of characters differ greatly each year, the percentage of missing values is pretty stable each year. It means that Marvels will keep certain proportion of character to be alive.

## Using function from Q2 of Pset4

```{r}
#Creation of the Function 
missing_plot_function <- function(data, per = FALSE){
     missing_patterns <- data.frame(is.na(data)) %>%
     group_by_all() %>%
     count(name = "count", sort = TRUE) %>%
     ungroup()

  # Sorting the missing patterns in Decreasing
  missing_patterns <- missing_patterns[order(missing_patterns$count, decreasing = TRUE), ]
  
  # Storing the sorted colnames in the variable sorted_colnames
  sorted_colnames <- colSums(is.na(data)) %>% 
  sort(decreasing = TRUE)
  
  # Sorting again keeping the sorted colnames under consideration
  missing_patterns <- missing_patterns[, append(names(sorted_colnames), "count")]
        row_number <- which(!apply(as.data.frame(missing_patterns)[1:dim(missing_patterns)[2]-1], 1, any))
  
  # Rownames columns will serve as y-axis
  missing_patterns$rownames <- row.names(missing_patterns)
  
  # tidydata for plotting
  tidy_data <- missing_patterns %>%
               select(-count) %>% 
               pivot_longer( -rownames, names_to = "Names", values_to = "Missing") 
  
  # Plot the core missing value plot
  center_part <- tidy_data %>% 
                 ggplot(aes(x = factor(Names, levels = names(sorted_colnames)),
                 y = fct_rev(factor(rownames, levels = missing_patterns$rownames)),
                 fill = Missing)) +
                 geom_tile(color = "white", show.legend = FALSE) +
                 annotate("text", x = dim(data)[2] %/% 2,y = nrow(missing_patterns) - row_number + 1,
                     label = "Complete Cases") +
                     scale_fill_brewer(palette = "BuPu") +
                     xlab("Variable") +
                     ylab("Missing Pattern")+
    theme(axis.text.x = element_text(angle = 60, hjust = 1))
  
  # Plot the missing values of a column
  top_df_part <- data.frame(as.list(sorted_colnames)) %>% 
                 pivot_longer(everything(),names_to = "Names",values_to = "num_rows_missing")
  
  if (per) { top_df_part$num_rows_missing = top_df_part$num_rows_missing*100/nrow(data)}
    
  top_part <- top_df_part %>% 
    ggplot(aes(x = factor(Names, levels = names(sorted_colnames)),
               y = num_rows_missing)) +
    geom_bar(stat = "identity",  fill = "steelblue", alpha=0.5) +
    xlab("Variable") +
    ylab(ifelse(per, "% Rows Missing", "Num Rows\n Missing"))+
     theme(axis.title.x =element_blank(),
           panel.grid.major.x = element_blank(),
           panel.grid.minor.x = element_blank(),
           axis.text.x = element_text(angle = 60, hjust = 1))
      
  
  # plot the row count for patterns
  right_df_part <- missing_patterns
  
  if (per) {
    right_df_part$count = right_df_part$count*100/nrow(data)
  }
    
  right_part <- right_df_part %>% 
    ggplot(aes(x = fct_rev(factor(rownames, levels = missing_patterns$rownames)),
               y = count)) +
    geom_bar(stat = "identity",  fill = "steelblue", alpha=0.5) +
    coord_flip() +
    xlab("Variable") +
    ylab(ifelse(per, "% Rows", "Row Count"))+
     theme(axis.title.y =element_blank(),
           panel.grid.major.y = element_blank(),
           panel.grid.minor.y = element_blank(),
           axis.text.x = element_text(angle = 60, hjust = 1))
      
  
  design <- "
    1#
    23
  "
  
  top_part + center_part + right_part + plot_layout(design = design, widths = c(3,1), heights = c(1,3))
}
```



```{r fig.width=15, fig.height=9}
missing_plot_function(avengers, per = FALSE)
```



```{r fig.width=15, fig.height=9}
missing_plot_function(avengers, per = TRUE)
```


We can see the distribution of missing values by using the function. The result is pretty similar to what we did above. There are only few columns is totally complete and most of missing values are concentrated in "death" and "return" columns. Meanwhile, there is no missing values in some columns including "current", "year", "gender".
<<<<<<< HEAD
>>>>>>> Stashed changes
>>>>>>> 07b14f4bcc72b559dff4a997ba31f1f64cde01c1
=======
>>>>>>> 2b7893f12026372d5019bd7e224f9ffdc53594bc

<!--chapter:end:04-missing.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
book# Results

The following script demonstrates the product of data visualization and analysis of the actual performance of the Golden Cross Investment scheme

Package 'plotly' and 'quantmod' are necessary for Candlestick visualization. 

```{r, include=FALSE}
library(plotly)
library(quantmod)
library(ggplot2)
```


```{r}

AAPL <- read.csv(file = 'AAPL.csv')

fig_aapl <- AAPL %>% plot_ly(x = AAPL$Date, type="candlestick",
          open = AAPL$Open, close = AAPL$Close,
          high = AAPL$High, low = AAPL$Low, showlegend = FALSE)

fig_aapl <- fig_aapl %>% layout(title = "AAPL Candlestick Chart",
         xaxis = list(rangeslider = list(visible = F)),  yaxis = list(title = 'Price ($)'))


fig_aapl <- fig_aapl %>% add_lines(x = ~Date, y = ~Open_10 , name = "10 MA",
            line = list(color = 'blue', width = 1.5),
            legendgroup = "10 MA",
            hoverinfo = "none", inherit = F) 


fig_aapl <- fig_aapl %>% add_lines(x = ~Date, y = ~Open_20, name = "20 MA",
            line = list(color =  'purple', width = 1.5),
            legendgroup = "20 MA", inherit = F, hoverinfo = "none") 


```


```{r}

COST <- read.csv(file = 'COST.csv')

fig_cost <- COST %>% plot_ly(x = AAPL$Date, type="candlestick",
          open = COST$Open, close = COST$Close,
          high = COST$High, low = COST$Low, showlegend = FALSE)

fig_cost <- fig_cost %>% layout(title = "COST Candlestick Chart",
         xaxis = list(rangeslider = list(visible = F)),  yaxis = list(title = 'Price ($)'))


fig_cost <- fig_cost %>% add_lines(x = ~Date, y = ~Open_10 , name = "10 MA",
            line = list(color = 'blue', width = 1.5),
            legendgroup = "10 MA",
            hoverinfo = "none", inherit = F) 


fig_cost <- fig_cost %>% add_lines(x = ~Date, y = ~Open_20, name = "20 MA",
            line = list(color =  'purple', width = 1.5),
            legendgroup = "20 MA", inherit = F, hoverinfo = "none") 

```


```{r}
MSFT <- read.csv(file = 'MSFT.csv')

fig_msft <- MSFT %>% plot_ly(x = MSFT$Date, type="candlestick",
          open = MSFT$Open, close = MSFT$Close,
          high = MSFT$High, low = MSFT$Low, showlegend = FALSE)

fig_msft <- fig_msft %>% layout(title = "MSFT Candlestick Chart",
         xaxis = list(rangeslider = list(visible = F)),  yaxis = list(title = 'Price ($)'))


fig_msft <- fig_msft %>% add_lines(x = ~Date, y = ~Open_10 , name = "10 MA",
            line = list(color = 'blue', width = 1.5),
            legendgroup = "10 MA",
            hoverinfo = "none", inherit = F) 


fig_msft <- fig_msft%>% add_lines(x = ~Date, y = ~Open_20, name = "20 MA",
            line = list(color =  'purple', width = 1.5),
            legendgroup = "20 MA", inherit = F, hoverinfo = "none") 

```


```{r}
GM <- read.csv(file = 'GM.csv')

fig_gm <- GM %>% plot_ly(x = GM$Date, type="candlestick",
          open = GM$Open, close = GM$Close,
          high = GM$High, low = GM$Low, showlegend = FALSE)

fig_gm <- fig_gm %>% layout(title = "GM Candlestick Chart",
         xaxis = list(rangeslider = list(visible = F)),  yaxis = list(title = 'Price ($)'))


fig_gm <- fig_gm %>% add_lines(x = ~Date, y = ~Open_10 , name = "10 MA",
            line = list(color = 'blue', width = 1.5),
            legendgroup = "10 MA",
            hoverinfo = "none", inherit = F) 


fig_gm <- fig_gm %>% add_lines(x = ~Date, y = ~Open_20, name = "20 MA",
            line = list(color =  'purple', width = 1.5),
            legendgroup = "20 MA", inherit = F, hoverinfo = "none") 

```

```{r}
NVDA <- read.csv(file = 'NVDA.csv')

fig_nvda <- NVDA %>% plot_ly(x = NVDA$Date, type="candlestick",
          open = NVDA$Open, close = NVDA$Close,
          high = NVDA$High, low = NVDA$Low, showlegend = FALSE)

fig_nvda <- fig_nvda %>% layout(title = "NVDA Candlestick Chart",
         xaxis = list(rangeslider = list(visible = F)),  yaxis = list(title = 'Price ($)'))


fig_nvda <- fig_nvda %>% add_lines(x = ~Date, y = ~Open_10 , name = "10 MA",
            line = list(color = 'blue', width = 1.5),
            legendgroup = "10 MA",
            hoverinfo = "none", inherit = F) 


fig_nvda <- fig_nvda %>% add_lines(x = ~Date, y = ~Open_20, name = "20 MA",
            line = list(color =  'purple', width = 1.5),
            legendgroup = "20 MA", inherit = F, hoverinfo = "none") 

```

```{r}
TSLA <- read.csv(file = 'TSLA.csv')

fig_tsla <- TSLA %>% plot_ly(x = TSLA$Date, type="candlestick",
          open = TSLA$Open, close = TSLA$Close,
          high = TSLA$High, low = TSLA$Low, showlegend = FALSE)

fig_tsla <- fig_tsla%>% layout(title = "TSLA Candlestick Chart",
         xaxis = list(rangeslider = list(visible = F)),  yaxis = list(title = 'Price ($)'))


fig_tsla <- fig_tsla %>% add_lines(x = ~Date, y = ~Open_10 , name = "10 MA",
            line = list(color = 'blue', width = 1.5),
            legendgroup = "10 MA",
            hoverinfo = "none", inherit = F) 


fig_tsla <- fig_tsla %>% add_lines(x = ~Date, y = ~Open_20, name = "20 MA",
            line = list(color =  'purple', width = 1.5),
            legendgroup = "20 MA", inherit = F, hoverinfo = "none") 

```

```{r}
fig_aapl
fig_cost
fig_msft
fig_tsla
fig_nvda
fig_gm
```

```{r, include=FALSE}
library(grid)
library(gridExtra)
```

```{r}
fig <- subplot(fig_aapl, fig_cost, fig_msft, fig_tsla, fig_nvda, fig_gm,  nrows=2)  %>%
  layout(title = list(text = "Stock Price with Moving Average"),
         plot_bgcolor='#e5ecf6', 
         xaxis = list( 
           zerolinecolor = '#ffff', 
           zerolinewidth = 2, 
           gridcolor = 'ffff'), 
         yaxis = list( 
           zerolinecolor = '#ffff', 
           zerolinewidth = 2, 
           gridcolor = 'ffff'))
fig
```

Golden Cross Investment Return:

Componded Return calculated in Excel (INDIRECT(ADDRESS(ROW()-1,COLUMN())) * (1 + T2)), assuming an initial investment of $10000

```{r}
aapl_gain = read.csv(file = 'aapl_gain.csv')
cost_gain = read.csv(file = 'cost_gain.csv')
msft_gain = read.csv(file = 'msft_gain.csv')
tsla_gain = read.csv(file = 'tsla_gain.csv')
nvda_gain = read.csv(file = 'nvda_gain.csv')
gm_gain = read.csv(file = 'gm_gain.csv')

```


```{r}
aapl_gain$sym <- 'aapl'
cost_gain$sym <- 'cost'
msft_gain$sym <- 'msft'
tsla_gain$sym <- 'tsla'
nvda_gain$sym <- 'nvda'
gm_gain$sym <- 'gm'
```


```{r}
df_stock <- rbind(aapl_gain, cost_gain ,msft_gain, tsla_gain,nvda_gain,gm_gain )
```


```{r}
ggplot(df_stock, aes(x=Date, y=X10000, group=sym, color = sym))+
  geom_line(aes(group=sym))+
  geom_point() +
  xlab('Trading Days')+
  ylab('Investment Returns ($)')+
  labs(title="Golden Cross Investment Returns Over time (Start from $10000)")
```

```{r}
ggplot(df_stock, aes(x=reorder(sym,growth, median, na.rm = TRUE), y=growth, color=sym)) + 
  geom_boxplot() + coord_flip() +
  xlab('Stock')+
  ylab('Investment Growth Over Time')+
  labs(title="Golden Cross Investment Returns Over time")
```

```{r}
compond_rate = c(tail(aapl_gain$rate, n=1),
                 tail(cost_gain$rate, n=1),
                 tail(msft_gain$rate, n=1),
                 tail(tsla_gain$rate, n=1),
                 tail(nvda_gain$rate, n=1),
                 tail(gm_gain$rate, n=1))

df_compond <- data.frame(compond_rate)

ggplot(df_compond, aes(y= df_compond$compond_rate)) + 
  geom_boxplot()+
  geom_hline(yintercept=0.8294, linetype="dashed", color = "red", size=1)+
  annotate(geom="text", x=0, y=-1, label="82.94% average S&P 500 return from 2019 to 2021",
              color="red")+
  ylab('Investment Compond Growth rate')+
  labs(title="Golden Cross Investment Compond Return Rate (All the stock combined)")

```
```{r}
df_compond$compond_rate
```
The data of the actual return of S&P 500 over years comes from Webull Stock Broker.





<!--chapter:end:05-results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component


Package 'plotly' and 'quantmod' are necessary for Candlestick visualization. 

The candlestick plots with moving averages are interactive. The
readers should also be able to zoom in and click on the bar to check
the detailed information of each 'candle'.

```{r, include=FALSE}
library(plotly)
library(quantmod)
library(ggplot2)
```


```{r, include=FALSE}

AAPL <- read.csv(file = 'AAPL.csv')

fig_aapl <- AAPL %>% plot_ly(x = AAPL$Date, type="candlestick",
          open = AAPL$Open, close = AAPL$Close,
          high = AAPL$High, low = AAPL$Low, showlegend = FALSE)

fig_aapl <- fig_aapl %>% layout(title = "AAPL Candlestick Chart",
         xaxis = list(rangeslider = list(visible = F)),  yaxis = list(title = 'Price ($)'))


fig_aapl <- fig_aapl %>% add_lines(x = ~Date, y = ~Open_10 , name = "10 MA",
            line = list(color = 'blue', width = 1.5),
            legendgroup = "10 MA",
            hoverinfo = "none", inherit = F) 


fig_aapl <- fig_aapl %>% add_lines(x = ~Date, y = ~Open_20, name = "20 MA",
            line = list(color =  'purple', width = 1.5),
            legendgroup = "20 MA", inherit = F, hoverinfo = "none") 


```


```{r, include=FALSE}

COST <- read.csv(file = 'COST.csv')

fig_cost <- COST %>% plot_ly(x = AAPL$Date, type="candlestick",
          open = COST$Open, close = COST$Close,
          high = COST$High, low = COST$Low, showlegend = FALSE)

fig_cost <- fig_cost %>% layout(title = "COST Candlestick Chart",
         xaxis = list(rangeslider = list(visible = F)),  yaxis = list(title = 'Price ($)'))


fig_cost <- fig_cost %>% add_lines(x = ~Date, y = ~Open_10 , name = "10 MA",
            line = list(color = 'blue', width = 1.5),
            legendgroup = "10 MA",
            hoverinfo = "none", inherit = F) 


fig_cost <- fig_cost %>% add_lines(x = ~Date, y = ~Open_20, name = "20 MA",
            line = list(color =  'purple', width = 1.5),
            legendgroup = "20 MA", inherit = F, hoverinfo = "none") 

```


```{r, include=FALSE}
MSFT <- read.csv(file = 'MSFT.csv')

fig_msft <- MSFT %>% plot_ly(x = MSFT$Date, type="candlestick",
          open = MSFT$Open, close = MSFT$Close,
          high = MSFT$High, low = MSFT$Low, showlegend = FALSE)

fig_msft <- fig_msft %>% layout(title = "MSFT Candlestick Chart",
         xaxis = list(rangeslider = list(visible = F)),  yaxis = list(title = 'Price ($)'))


fig_msft <- fig_msft %>% add_lines(x = ~Date, y = ~Open_10 , name = "10 MA",
            line = list(color = 'blue', width = 1.5),
            legendgroup = "10 MA",
            hoverinfo = "none", inherit = F) 


fig_msft <- fig_msft%>% add_lines(x = ~Date, y = ~Open_20, name = "20 MA",
            line = list(color =  'purple', width = 1.5),
            legendgroup = "20 MA", inherit = F, hoverinfo = "none") 

```


```{r, include=FALSE}
GM <- read.csv(file = 'GM.csv')

fig_gm <- GM %>% plot_ly(x = GM$Date, type="candlestick",
          open = GM$Open, close = GM$Close,
          high = GM$High, low = GM$Low, showlegend = FALSE)

fig_gm <- fig_gm %>% layout(title = "GM Candlestick Chart",
         xaxis = list(rangeslider = list(visible = F)),  yaxis = list(title = 'Price ($)'))


fig_gm <- fig_gm %>% add_lines(x = ~Date, y = ~Open_10 , name = "10 MA",
            line = list(color = 'blue', width = 1.5),
            legendgroup = "10 MA",
            hoverinfo = "none", inherit = F) 


fig_gm <- fig_gm %>% add_lines(x = ~Date, y = ~Open_20, name = "20 MA",
            line = list(color =  'purple', width = 1.5),
            legendgroup = "20 MA", inherit = F, hoverinfo = "none") 

```

```{r, include=FALSE}
NVDA <- read.csv(file = 'NVDA.csv')

fig_nvda <- NVDA %>% plot_ly(x = NVDA$Date, type="candlestick",
          open = NVDA$Open, close = NVDA$Close,
          high = NVDA$High, low = NVDA$Low, showlegend = FALSE)

fig_nvda <- fig_nvda %>% layout(title = "NVDA Candlestick Chart",
         xaxis = list(rangeslider = list(visible = F)),  yaxis = list(title = 'Price ($)'))


fig_nvda <- fig_nvda %>% add_lines(x = ~Date, y = ~Open_10 , name = "10 MA",
            line = list(color = 'blue', width = 1.5),
            legendgroup = "10 MA",
            hoverinfo = "none", inherit = F) 


fig_nvda <- fig_nvda %>% add_lines(x = ~Date, y = ~Open_20, name = "20 MA",
            line = list(color =  'purple', width = 1.5),
            legendgroup = "20 MA", inherit = F, hoverinfo = "none") 

```

```{r, include=FALSE}
TSLA <- read.csv(file = 'TSLA.csv')

fig_tsla <- TSLA %>% plot_ly(x = TSLA$Date, type="candlestick",
          open = TSLA$Open, close = TSLA$Close,
          high = TSLA$High, low = TSLA$Low, showlegend = FALSE)

fig_tsla <- fig_tsla%>% layout(title = "TSLA Candlestick Chart",
         xaxis = list(rangeslider = list(visible = F)),  yaxis = list(title = 'Price ($)'))


fig_tsla <- fig_tsla %>% add_lines(x = ~Date, y = ~Open_10 , name = "10 MA",
            line = list(color = 'blue', width = 1.5),
            legendgroup = "10 MA",
            hoverinfo = "none", inherit = F) 


fig_tsla <- fig_tsla %>% add_lines(x = ~Date, y = ~Open_20, name = "20 MA",
            line = list(color =  'purple', width = 1.5),
            legendgroup = "20 MA", inherit = F, hoverinfo = "none") 

```

```{r}
fig_aapl
fig_cost
fig_msft
fig_tsla
fig_nvda
fig_gm
```

```{r, include=FALSE}
library(grid)
library(gridExtra)
```

```{r}
fig <- subplot(fig_aapl, fig_cost, fig_msft, fig_tsla, fig_nvda, fig_gm,  nrows=2)  %>%
  layout(title = list(text = "Stock Price with Moving Average"),
         plot_bgcolor='#e5ecf6', 
         xaxis = list( 
           zerolinecolor = '#ffff', 
           zerolinewidth = 2, 
           gridcolor = 'ffff'), 
         yaxis = list( 
           zerolinecolor = '#ffff', 
           zerolinewidth = 2, 
           gridcolor = 'ffff'))
fig
```

<!--chapter:end:06-interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion

Golden Cross Investment Return:

Componded Return calculated in Excel (INDIRECT(ADDRESS(ROW()-1,COLUMN())) * (1 + T2)), assuming an initial investment of $10000

```{r, include=FALSE}
aapl_gain = read.csv(file = 'aapl_gain.csv')
cost_gain = read.csv(file = 'cost_gain.csv')
msft_gain = read.csv(file = 'msft_gain.csv')
tsla_gain = read.csv(file = 'tsla_gain.csv')
nvda_gain = read.csv(file = 'nvda_gain.csv')
gm_gain = read.csv(file = 'gm_gain.csv')

```


```{r, include=FALSE}
aapl_gain$sym <- 'aapl'
cost_gain$sym <- 'cost'
msft_gain$sym <- 'msft'
tsla_gain$sym <- 'tsla'
nvda_gain$sym <- 'nvda'
gm_gain$sym <- 'gm'
```


```{r, include=FALSE}
df_stock <- rbind(aapl_gain, cost_gain ,msft_gain, tsla_gain,nvda_gain,gm_gain )
```


```{r}
ggplot(df_stock, aes(x=Date, y=X10000, group=sym, color = sym))+
  geom_line(aes(group=sym))+
  geom_point() +
  xlab('Trading Days')+
  ylab('Investment Returns ($)')+
  labs(title="Golden Cross Investment Returns Over time (Start from $10000)")
```

```{r}
ggplot(df_stock, aes(x=reorder(sym,growth, median, na.rm = TRUE), y=growth, color=sym)) + 
  geom_boxplot() + coord_flip() +
  xlab('Stock')+
  ylab('Investment Growth Over Time')+
  labs(title="Golden Cross Investment Returns Over time")
```

```{r}
compond_rate = c(tail(aapl_gain$rate, n=1),
                 tail(cost_gain$rate, n=1),
                 tail(msft_gain$rate, n=1),
                 tail(tsla_gain$rate, n=1),
                 tail(nvda_gain$rate, n=1),
                 tail(gm_gain$rate, n=1))

df_compond <- data.frame(compond_rate)

ggplot(df_compond, aes(y= df_compond$compond_rate)) + 
  geom_boxplot()+
  geom_hline(yintercept=0.8294, linetype="dashed", color = "red", size=1)+
  annotate(geom="text", x=0, y=-1, label="82.94% average S&P 500 return from 2019 to 2021",
              color="red")+
  ylab('Investment Compond Growth rate')+
  labs(title="Golden Cross Investment Compond Return Rate (All the stock combined)")

```
```{r}
df_compond$compond_rate
```
The data of the actual return of S&P 500 over years comes from Webull Stock Broker.

The Golden Cross scheme managed to achieve a median return much higher than the average return of S&P 500 Index funds over the span of the data (Two years). This investment plan outperform the general market when being applied to major stocks that are included in the index funds.

<!--chapter:end:07-conclusion.Rmd-->

